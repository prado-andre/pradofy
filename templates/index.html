<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download do Prado</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}">
    <style>
        /* Seu CSS continua igual */
        :root { --background-color: #f4f4f9; --container-bg: #ffffff; --text-color: #333; --primary-color: #007bff; --primary-hover: #0056b3; --error-color: #dc3545; --success-color: #28a745; --border-radius: 8px; --box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--background-color); color: var(--text-color); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background-color: var(--container-bg); padding: 2rem 2.5rem; border-radius: var(--border-radius); box-shadow: var(--box-shadow); text-align: center; width: 90%; max-width: 500px; }
        h1 { margin-bottom: 1.5rem; }
        .url-input { width: 100%; padding: 0.8rem; font-size: 1rem; border: 1px solid #ccc; border-radius: var(--border-radius); box-sizing: border-box; margin-bottom: 1.5rem; }
        .submit-btn { width: 100%; padding: 0.8rem; font-size: 1.1rem; font-weight: bold; color: #fff; background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.2s; }
        .submit-btn:disabled { background-color: #a0a0a0; cursor: not-allowed; }
        .status-message { color: var(--text-color); margin-top: 1rem; font-weight: 500; min-height: 1.5em; }
        .status-message.error { color: var(--error-color); }
        .status-message.success { color: var(--success-color); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Download do Prado</h1>
        <form id="download-form">
            <input type="url" name="url" id="url-input" class="url-input" placeholder="Cole a URL (YouTube, Spotify, etc)" required>
            <button type="submit" class="submit-btn" id="submit-btn">Baixar MP3</button>
        </form>
        <p id="status-message" class="status-message"></p>
    </div>

    <script>
        const downloadForm = document.getElementById('download-form');
        const urlInput = document.getElementById('url-input');
        const submitButton = document.getElementById('submit-btn');
        const statusMessage = document.getElementById('status-message');

        // A função agora é 'async' para esperar a resposta do Python
        downloadForm.addEventListener('submit', async (event) => {
            // Previne o envio padrão do formulário
            event.preventDefault();

            // Pega a URL e limpa mensagens antigas
            const url = urlInput.value;
            statusMessage.textContent = '';
            statusMessage.className = 'status-message';
            
            // Desabilita o botão e mostra feedback
            submitButton.disabled = true;
            submitButton.textContent = 'Baixando...';

            try {
                // Chama a função 'download' do Python e espera o resultado
                const result = await window.pywebview.api.download(url);
                
                // Exibe o resultado (sucesso ou erro) retornado pelo Python
                if (result.status === 'success') {
                    statusMessage.textContent = 'Download Concluído!';
                    statusMessage.classList.add('success');
                } else {
                    statusMessage.textContent = result.message;
                    statusMessage.classList.add('error');
                }
            } catch (e) {
                statusMessage.textContent = 'Ocorreu um erro inesperado na comunicação.';
                statusMessage.classList.add('error');
            }

            // Reabilita o botão
            submitButton.disabled = false;
            submitButton.textContent = 'Baixar MP3';
        });
    </script>
</body>
</html>